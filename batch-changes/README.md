# Batch changes for fixing/mitigating [log4j CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)

This directory contains Sourcegraph [Batch Changes](https://docs.sourcegraph.com/batch_changes) specs to fix and mitigate [log4j CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228) and [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046).

#### CVE-2021-44228 mitigation specs

- [upgrade-log4j-gradle.yml](upgrade-log4j-gradle.yml): Force usage of safe log4j dependency versions (including for transitive dependencies) in all Gradle projects (using `build.gradle` files) that use affected log4j dependency versions.
- [detect-log4j-gradle.yml](detect-log4j-gradle.yml): Detect Gradle projects (using `build.gradle` files) that use affected log4j dependency versions and leave a `fixme` file in the repository to create a dynamic list of affected repositories.
- [detect-log4j-maven.yml](detect-log4j-gradle.yml): Detect Maven projects (using `pom.xml` files) that use affected log4j dependency versions and and leave a `fixme` file in the repository to create a dynamic list of affected repositories
- [patternlayout-fix.yml](patternlayout-fix.yml): Replace the `%m` message converter by `%m{nolookups}` in `PatternLayout`, for those who can't upgrade to 2.16.0 and are on log4j releases >=2.7 and <=2.15.0.

#### About Batch Changes

Batch Changes is a tool to apply and track code changes across many repositories and code hosts. You specify a Sourcegraph search [query](https://sourcegraph.com/search?q=context:global+file:build.gradle+NOT+content:%23upgrade-log4j-gradle-cve-2021-44228&patternType=literal) to get a list of repositories and a script to run in each, then Batch Changes opens changesets on all affected repositories or projects and tracks them until they are merged.

- [Quickstart](https://docs.sourcegraph.com/batch_changes/quickstart)
- [Walkthrough video](https://www.youtube.com/watch?v=eOmiyXIWTCw)
